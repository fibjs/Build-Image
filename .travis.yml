dist: trusty
language: cpp
services:
  - docker
env:
  global:
    - secure: Fyfh78NfxLQsc/9WwWPEBCEMVMiaLnw6jpj6NsKNgI6r36/3qeIdM3zVTPxgFRJ6dM3d59TiYrilLQ2dzPQ0PTUmX2umSowU0WiYDO/a8rFw9fe4y1oc0/6d9auDcmu+RGedhUeKZ4+JfcA1YFQztm1CSbvMn/pz1Nz8V6V+mAHQoAebSMIKwQpAcP0gKQWzcrNANAOVy3OFBpJorsAr9JwNWAiRXvaHEwB5Lyj3Wijq9NiT5izfaQeuL/aHYTs/61P0HbcNJYEPWTqxCrX64HbEme9Ugl1GjmXRNkzP3pYh8k+WD3C/cnQcoku3s7AteIJGf1CyJHK0JTZlbLvHXznCj8z2+k7J5fC74BVVT/MJEm4PoxRpZLZ32uuH84fFsf8BIiNawhAghYy6s8BROMt1ttFI/+QP5TbJ2EAe8bRTcBI7ky9CtmIs9qRkUGl7q0Xz+fvhGrn9gpKOuEJ8A09dKF1cD6BUry5Q6HrznMJswgXVdEvzWco3C2M+L60MW6rA3ICt8KFHMlAYYQQtUSs4mA14WxuGzq8SAwf0H3/6+g2h/j/F8Cb6nMXRIwKPvVy1U9omuNZfTJWgzB9opl5Dxv3dGmwRGss6b6gEFWzNbg7dS+yHEJukEOnF70VenRetEEHT8QOVTqrPd4UlUFtC6ho8hSORsIEPwZee/I0=
    - secure: axHpbFzFrsICPmMIKSy9wwXMy0oDXCHJE4ovENyU8kzXOoIjERi7S40XpAzv7AsuH4GG/YYYWS2QnwdTapsWyAX4I++0NN5mvBuZNXvguRiD6GfPkePAJvHF/4I7AnmR6//5Fu8kgWZ0qPDCALjpy5kmcgSdPoA4BKKsXHhxAtzAr5q+M93PcuszuzcbXZRQp3E8leoXNaOzYti+bj/l+cV4Fa7cNMqJCK7SJhoW2GaqaYXMGMqTWv7IXvf898JCbcWVQflFkUk7G1hFDQdo29KpNj5dm9250BQ0zwnsSbWtfNu9QhX+FOlXHSn7cKxJp36clWU3JYbnxCrb2aHxknuRDsLtlbw3GRkqUGpxbHMwaJ06zLbC45U2Zkk64nNJH637J8Tx5RGBnmQgB/damidAuCRXiu3GtAGCv4Uv0jaCh/KXGZMzPonyIe/93GWlQkoIS9JrDWinakwhJ7vux67rbfc3vVq2Q7NWn1FDRTMeFAJXdjDyPXO+6EdmhyAU5bYio2cd6sNDz5MgghWDGuhU2dFp5EAWORfEh/UQl4v0l4N4ClkdOqEKnTZLG3U5xHX1FAmRw0K1Dxs4HPo1iomMeWzyHxkpFZhH87R6FiCjpEJihOYcHd7oGzY9KD6CMCTBE7gLyT2lHD4ROa3VKv6IvFrg2+KiKUdWL5GP2K8=
    - secure: iw4rp/wv1TP52+qJs9FQJ4EYBD2/FCo7uYO/MhwDmvZIqGJYteU7qXG3COp67SZ800CJUcFDrJMfoXzjJVr+3YT4Z/qDNnx7zy1t33+RYJFRH/r5bv4vUvV9nMIjBuvtthNv70uX4/rPA05oI/4K5blVv1RZgoXIFnCJIoHk3ZofOWa84QL0aCVAtF7N3i/nwDOFquirbQ7eHDFD+Sf9UH9Oh3MHVK2QTRGPEw9XNzN26DS34Y0aCoP6+oGM9Ztuj3RxNj3JSrFzL+izl3XO7NPHqarkHbgWfSV9iESsQxEzrz9YS5o8Dh6QZl9JXffQF4njlTmn6uZwpIZcbxcJUvlH2C3Jh66bSapotpXs1LsXUsAwwEzSq5o3avfbUNniTaU5iwjr9plHHrpOuyUx+2YDauQZXKeMbNhhxnG8F8SfEjfoVVxTJJ0svP4oM+6/trweZIqjBBOIIYz+TjyaZ7cLFrqLla2K1e0wSP7Z7D7uWjac/xdGlCsQfmOGjthpdiCy8X9Mg99TCGWcSVx7qiSq+Q32KOtPDdIYBB+HN9od0J0xaEH3q9oNVNGHS3oiyA8CNkdKK2uch8IfT1jg6M2hh0V/18F/KtW9Z5ke+z+yGTnspslgHnQ696cAypDQkGR/slgsHciriFEkQ2YqezAbZRV6kcEj1ys0PdnVlB4=
- COMMIT=${TRAVIS_COMMIT::8}
script:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=fibjs/build-env
  - export BRANCH=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_BRANCH; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi)
  - export TAG=`if [ "$BRANCH" == "master" ]; then echo "latest"; else echo $BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
